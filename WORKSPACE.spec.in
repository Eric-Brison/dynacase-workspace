#! /bin/rpm
#
#  File: 
#  $Id: WORKSPACE.spec.in,v 1.22 2007/10/17 08:22:05 eric Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define cerbere         %(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'none' && echo 1 || echo 0)
%define pld		%(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'PLD' && echo 1 || echo 0)
%define redhat	        %(rpm -q --queryformat '%{VENDOR}' rpm | grep -q -e 'Red Hat, Inc.' -e "Fedora"  && echo 1 || echo 0)
%{?ncerbere:%define cerbere 1}
%{?ncerbere:%define redhat 0}
%{?ncerbere:%define pld 0}
%{?nredhat:%define cerbere 0}
%{?nredhat:%define redhat 1}
%{?nredhat:%define pld 0}
%{?npld:%define cerbere 0}
%{?npld:%define redhat 0}
%{?npld:%define pld 1}
%{?nobuildrequired:%define pld 1}

%if %{cerbere}
  %define destdir /home/httpd/what
  %define httpuser http
  %define apacheconfdir /etc/httpd/httpd.conf
  %define releasepostfix %(echo)
%else
  %if %{pld}
    %define destdir /usr/share/what
    %define httpuser http
    %define apacheconfdir /etc/webapps/what
    %define releasepostfix cb
   %else
      %if %{redhat}
        %define destdir /usr/share/what
        %define httpuser apache
        %define apacheconfdir /etc/httpd/conf.d
        %define releasepostfix fc%(cat /etc/fedora-release | sed -e 's/.* release \\([[:digit:]]\\+\\) .*/\\1/')
      %else        
        %define destdir /usr/share/what
        %define httpuser apache
        %define apacheconfdir /etc/httpd/conf.d
        %define releasepostfix unk
      %endif
  %endif
%endif

%{?ndestdir:%define destdir %{ndestdir}}
%{?nhttpuser:%define httpuser %{nhttpuser}}
%{?rpost:%define releasepostfix %{rpost}}

Summary: The Work Space to exchange files
Name: @PACKAGE@
Version: @VERSION@
Release: @RELEASE@%{releasepostfix}
License: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
# post-2.2.0 fix (can go away with next release):
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Yannick Le Briquer <yannick.lebriquer@anakeen.com>
BuildArchitectures: noarch
BuildRoot: /tmp/anakeen-root
Requires: FREEDOM-LIB >= 2.7.4
Requires: FREEDOM-COMMON >= 0.2.1
Requires: FREEDOM-DAV 
Requires: VAULT >= 2.0.4
Requires: FCKeditor
%if %{pld}
Requires: xlhtml
Requires: html2ps
Requires: ImageMagick-coder-jpeg2
Requires: ImageMagick-coder-ps2
Requires: ImageMagick-coder-png
Requires: ImageMagick-coder-pdf
Requires: ImageMagick-coder-svg
Requires: ImageMagick-coder-jpeg
Requires: ImageMagick-coder-url
Requires: ImageMagick-coder-tiff
%endif
Prereq: WHAT 
Prereq: gettext


%description
The freedom WorkSpace is use to exchange file document between members of groups




%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure --with-pubrule=`pwd`
make  pubdir=$RPM_BUILD_ROOT%{destdir} 
install -d $RPM_BUILD_ROOT/%{destdir}/FDL
cd $RPM_BUILD_ROOT/%{destdir}/FDL
ln -s ../@PACKAGE@/Method.*.php  .

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post
%{destdir}/wstop




%preun
%postun
%{destdir}/wstop



%files
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/%{name}
%{destdir}/%{name}/*
%{destdir}/locale/*
%{destdir}/FDL/*



%changelog
* Tue Oct 30 2000 Yannick Le Briquer <yannick.lebriquer@anakeen.com>
- Build first RPM

