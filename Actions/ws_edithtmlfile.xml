<html>
	<head>
		<title>[edittitle]</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="robots" content="noindex, nofollow">
		<script type="text/javascript" src="fckeditor/fckeditor.js"></script>

[JS:REF]
<script>
[JS:CODE]
function submitfile(event,docid,attrid) {
  if (window.opener) {
    if (window.opener.attributeSend) {

       cursorwait();
      // Get the editor instance that we want to interact with.
	var oEditor = FCKeditorAPI.GetInstance('wsfile') ;

	// Get the editor contents in XHTML.

	var newval= oEditor.GetXHTML( true );

	// var newval='<html>'+oEditor.EditorDocument.body.innerHTML+'</html>';


	var menuurl='';
	if (isNetscape) menuurl='../../';
	menuurl=menuurl+'[CORE_STANDURL]app=FDL&action=MODATTRIBUTE&stayedit=yes&docid='+docid+'&attrid='+attrid;
      
       window.opener.attributeSend(event,menuurl,null,newval);
       oEditor.ResetIsDirty();
       cursorauto();
    }
  }
}

var OURL;
function ws_autoclose(event) {
  if ((! window.opener) || (window.opener.closed)) self.close();

  var a;
  try{
    a=window.opener.location;
    a=window.opener.location.href;
  }
  catch(exception) {
    self.close();
  }
  
  if ( (! window.opener.location)  || (! window.opener.location.href) || (window.opener.location.href != OURL)) {
    self.close();
  }  
}
if (window.opener)   {
    OURL=window.opener.location.href;
    setInterval('ws_autoclose()',2000);
 }

function wscanceledit(event) {

  window.opener.cancelattr(event,'[docid]','[attrid]');
  
}

function getHTMLFile(oed) {
  var req;

    // branch for native XMLHttpRequest object
    if (window.XMLHttpRequest) {
        req = new XMLHttpRequest(); 
    } else if (window.ActiveXObject) {
      // branch for IE/Windows ActiveX version     
      req = new ActiveXObject("Microsoft.XMLHTTP");
    }
    if (req) {
     
      req.open("POST", '[CORE_STANDURL]app=WORKSPACE&action=WS_DOWNLOADFILE&id=[docid]&inline=yes',false);
      //      req.setRequestHeader("Content-length", "1"); 
     
      req.send('');

      if(req.status == 200) {
	   
	if (req.responseText) {
	  //var oEditor = FCKeditorAPI.GetInstance('wsfile') ;
	  //oEditor.SetHTML(req.responseText);
	  oed.Value=req.responseText;
	}
	else {
	  alert('no txt\n'+req.responseText);
	  return;
	} 
      }
     
    }    
}
var oFCKeditor = new FCKeditor( 'wsfile' ) ;


function cursorwait() {
  var j=window.frames[0];
  
   globalcursor('progress',j);
     globalcursor('progress',j.frames[0]);
}
function cursorauto() {
  var j=window.frames[0];

   unglobalcursor(j);
    unglobalcursor(j.frames[0]);
}
function wsIsModified() {
  return FCKeditorAPI.GetInstance('wsfile').IsDirty();
}
</script>
<style>
body {
  background-color:white;
  margin:0px;
}
</style>
	</head>

	<body onunload="wscanceledit(event);return false"
	onbeforeunload="if (wsIsModified()) return '[TEXT:The text has be modified]'" >
		
		<form action="[CORE_STANDURL]app=WORKSPACE&action=WS_MODHTMLFILE" method="post" target="_blank" onsubmit="submitfile(event,'[docid]','[attrid]');return false" style="display:inline">
		<input type="hidden" name="id" value="[docid]">
		<input type="hidden" name="attrid" value="[attrid]">
			<script type="text/javascript">
<!--

oFCKeditor.BasePath = 'fckeditor/';


oFCKeditor.ToolbarSet = 'ws';
oFCKeditor.Config['FullPage'] = true ;

oFCKeditor.Config['SkinPath'] =  'skins/silver/';
[IFNOT BIG]oFCKeditor.Value='[fullhtml]';[ENDIF BIG]
oFCKeditor.Height='100%';
oFCKeditor.Width='100%';
[IF BIG]getHTMLFile(oFCKeditor)[ENDIF BIG]
oFCKeditor.Create();

//-->
			</script>
		</form>
	</body>
</html>
